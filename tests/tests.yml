presets:
  definition: &definition
    inherits: null
    attributes: []
    members: []
  interface: &interface
    <<: *definition
    definition: interface
  exception: &exception
    <<: *definition
    definition: exception
  typedef: &typedef
    definition: typedef
    attributes: []
  attribute: &attribute
    memberType: attribute
    readOnly: false
    inherit: false
  operation: &operation
    memberType: operation
    returnType: null
    arguments: []
    specials: []

tests:
  - name: Interfaces(1)
    idl: |
         [Constructor]
         interface GraphicalWindow {
           readonly attribute unsigned long width;
           readonly attribute unsigned long height;

           attribute Paint currentPaint;

           void drawRectangle(float x, float y, float width, float height);

           void drawText(float x, float y, DOMString text);
         };
    expected:
      - <<: *interface
        name: GraphicalWindow
        attributes:
          - Constructor
        members:
          - <<: *attribute
            name: width
            type: &unsignedLong
              name: unsigned long
              suffix: &emptySuffix
                array: false
                nullable: false
            readOnly: true
          - <<: *attribute
            name: height
            type: *unsignedLong
            readOnly: true
          - <<: *attribute
            name: currentPaint
            type:
              name: Paint
              suffix: *emptySuffix
          - <<: *operation
            name: drawRectangle
            arguments:
              - type: &float
                  name: float
                  suffix: *emptySuffix
                name: x
              - type: *float
                name: y
              - type: *float
                name: width
              - type: *float
                name: height
          - <<: *operation
            name: drawText
            arguments:
              - type: *float
                name: x
              - type: *float
                name: y
              - type: &DOMString
                  name: DOMString
                  suffix: *emptySuffix
                name: text
  - name: Interfaces(2)
    idl: |
         exception GraphicsException {
           DOMString reason;
         };

         interface Paint { };

         interface SolidColor : Paint {
           attribute float red;
           attribute float green;
           attribute float blue;
         };
    expected:
      - <<: *exception
        name: GraphicsException
        members:
          - {type: *DOMString, name: reason, memberType: field}
      - <<: *interface
        name: Paint
      - <<: *interface
        name: SolidColor
        inherits: Paint
        members:
          - <<: *attribute
            type: *float
            name: red
          - <<: *attribute
            type: *float
            name: green
          - <<: *attribute
            type: *float
            name: blue
  - name: Interfaces(3)
    idl: |
         interface System {

           // Operation identifier:          "createObject"
           // Operation argument identifier: "interface"
           object createObject(DOMString _interface);

           // Operation argument identifier: "interface"
           object[] createObjectArray(DOMString interface);

           // Operation has no identifier; it declares a getter.
           getter DOMString (DOMString keyName);
         };
    expected:
      - <<: *interface
        name: System
        members:
          - <<: *operation
            name: createObject
            arguments: [{type: *DOMString, name: _interface}]
            returnType: &object
              name: object
              suffix: *emptySuffix
          - <<: *operation
            name: createObjectArray
            arguments: [{type: *DOMString, name: interface}]
            returnType: {name: object, suffix: {array: true, nullable: false}}
          - <<: *operation
            name: null
            specials: [getter]
            arguments: [{type: *DOMString, name: keyName}]
            returnType: *DOMString
  - name: typedef
    idl: |
         typedef long[] ArrayOfLongs;
    expected:
      - <<: *typedef
        type:
            name: long
            suffix: {array: true, nullable: false}
        name: ArrayOfLongs
  - name: Using typedef
    idl: |
         interface B : A {
           void f(ArrayOfLongs x);
         };
    expected:
      - <<: *interface
        name: B
        inherits: A
        members:
          - <<: *operation
            name: f
            arguments:
              - name: x
                type:
                  name: ArrayOfLongs
                  suffix: *emptySuffix
  - name: Exceptions(1)
    idl: |
          exception FrameworkException {

            // Constant identifier: "ERR_NOT_FOUND"
            const long ERR_NOT_FOUND = 1;

            // Exception field identifier: "code"
            long code;
          };
    expected:
      - <<: *exception
        name: FrameworkException
        members:
          - memberType: const
            type: &long
              name: long
              suffix: *emptySuffix
            name: ERR_NOT_FOUND
            value: 1
          - memberType: field
            type: *long
            name: code

